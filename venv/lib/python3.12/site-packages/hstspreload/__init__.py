"""Check if a host is in the Google Chrome HSTS Preload list"""

import functools
import os
import typing

__version__ = "2024.1.5"
__checksum__ = "bf90bc670f17b8deb849f529cda7ef4f1ff40a92a7092115438910b83d8b6773"
__all__ = ["in_hsts_preload"]

# fmt: off
_GTLD_INCLUDE_SUBDOMAINS = {b'amazon', b'android', b'app', b'audible', b'azure', b'bank', b'bing', b'boo', b'channel', b'chrome', b'dad', b'day', b'dev', b'eat', b'esq', b'fire', b'fly', b'foo', b'gle', b'gmail', b'google', b'hangout', b'hotmail', b'imdb', b'ing', b'insurance', b'kindle', b'meet', b'meme', b'microsoft', b'mov', b'new', b'nexus', b'office', b'page', b'phd', b'play', b'prime', b'prof', b'rsvp', b'search', b'silk', b'skype', b'windows', b'xbox', b'xn--cckwcxetd', b'xn--jlq480n2rg', b'youtube', b'zappos', b'zip'}  # noqa: E501
_JUMPTABLE = [[(0, 11), (11, 5), (16, 19), (35, 42), (77, 26), (103, 12), None, (115, 19), (134, 22), (156, 7), (163, 13), (176, 18), None, (194, 29), (223, 37), (260, 19), (279, 9), (288, 36), (324, 24), (348, 10), (358, 18), None, (376, 62), (438, 8), (446, 22), (468, 19), (487, 13), (500, 14), (514, 14), None, None, (528, 40), (568, 20), (588, 25), (613, 22), (635, 13), (648, 28), None, (676, 15), (691, 25), (716, 8), (724, 13), (737, 10), None, (747, 17), (764, 6), (770, 19), (789, 16), (805, 5), (810, 10), (820, 14), (834, 11), (845, 12), (857, 27), (884, 7), (891, 11), (902, 15), (917, 12), (929, 20), (949, 8), (957, 27), (984, 46), (1030, 25), (1055, 16), (1071, 8), (1079, 5), (1084, 22), (1106, 18), None, (1124, 36), (1160, 15), (1175, 24), (1199, 11), None, (1210, 5), (1215, 23), (1238, 18), (1256, 18), None, (1274, 20), (1294, 26), (1320, 27), (1347, 19), (1366, 20), (1386, 59), (1445, 14), (1459, 14), (1473, 8), (1481, 8), (1489, 10), (1499, 13), (1512, 20), (1532, 29), None, (1561, 13), (1574, 26), (1600, 11), (1611, 4), (1615, 22), (1637, 10), (1647, 15), (1662, 14), (1676, 28), (1704, 11), (1715, 10), (1725, 12), (1737, 25), None, (1762, 10), (1772, 5), (1777, 26), (1803, 45), (1848, 15), None, (1863, 11), (1874, 30), (1904, 21), (1925, 26), (1951, 6), (1957, 6), (1963, 14), (1977, 5), (1982, 30), (2012, 23), (2035, 6), (2041, 17), (2058, 8), (2066, 22), (2088, 12), (2100, 59), (2159, 55), (2214, 12), (2226, 23), (2249, 16), (2265, 41), None, (2306, 24), (2330, 44), (2374, 6), (2380, 41), (2421, 22), (2443, 23), (2466, 31), (2497, 20), (2517, 8), (2525, 15), (2540, 12), (2552, 32), (2584, 25), (2609, 15), None, (2624, 46), (2670, 21), (2691, 17), (2708, 18), (2726, 26), (2752, 5), (2757, 37), (2794, 39), (2833, 16), (2849, 33), (2882, 17), (2899, 23), (2922, 21), (2943, 25), (2968, 8), (2976, 14), (2990, 7), (2997, 37), None, (3034, 18), (3052, 21), (3073, 20), (3093, 17), (3110, 24), (3134, 12), (3146, 36), (3182, 35), (3217, 12), (3229, 57), (3286, 25), (3311, 32), None, (3343, 8), (3351, 25), (3376, 18), (3394, 6), (3400, 23), None, (3423, 36), (3459, 33), (3492, 14), (3506, 16), (3522, 22), None, (3544, 30), (3574, 41), (3615, 50), (3665, 15), (3680, 20), (3700, 31), (3731, 21), (3752, 32), (3784, 24), (3808, 20), (3828, 17), (3845, 52), (3897, 6), (3903, 9), (3912, 12), (3924, 18), (3942, 11), (3953, 10), (3963, 39), (4002, 42), None, (4044, 36), (4080, 17), None, (4097, 8), (4105, 8), (4113, 7), None, (4120, 25), (4145, 17), None, (4162, 21), (4183, 35), (4218, 21), (4239, 10), (4249, 41), (4290, 11), (4301, 37), (4338, 25), (4363, 19), (4382, 12), (4394, 14), (4408, 23), (4431, 29), (4460, 14), (4474, 8), (4482, 47), (4529, 52), None, None, (4581, 47), (4628, 42), None, (4670, 18), None, (4688, 15), (4703, 8), (4711, 21), (4732, 6), (4738, 21), (4759, 22)], [(4781, 7869), (12650, 7554), (20204, 7946), (28150, 8097), (36247, 7452), (43699, 7594), (51293, 7979), (59272, 7382), (66654, 7593), (74247, 7335), (81582, 8018), (89600, 6962), (96562, 7722), (104284, 8667), (112951, 7610), (120561, 8562), (129123, 8593), (137716, 7121), (144837, 8011), (152848, 7184), (160032, 7998), (168030, 7475), (175505, 7726), (183231, 8185), (191416, 7879), (199295, 7520), (206815, 8112), (214927, 8648), (223575, 7313), (230888, 7682), (238570, 8278), (246848, 7883), (254731, 7709), (262440, 8019), (270459, 7555), (278014, 8242), (286256, 8057), (294313, 8629), (302942, 8110), (311052, 8245), (319297, 8170), (327467, 7230), (334697, 7449), (342146, 7763), (349909, 7590), (357499, 8174), (365673, 7474), (373147, 8977), (382124, 7654), (389778, 7194), (396972, 7622), (404594, 7387), (411981, 7821), (419802, 7876), (427678, 7380), (435058, 7791), (442849, 7961), (450810, 7955), (458765, 7776), (466541, 6607), (473148, 7173), (480321, 8040), (488361, 7741), (496102, 8191), (504293, 8512), (512805, 7444), (520249, 7856), (528105, 8196), (536301, 8814), (545115, 7749), (552864, 7240), (560104, 7391), (567495, 7033), (574528, 8459), (582987, 7478), (590465, 7979), (598444, 7493), (605937, 8565), (614502, 7799), (622301, 7689), (629990, 7826), (637816, 6973), (644789, 7850), (652639, 7964), (660603, 7826), (668429, 7875), (676304, 8479), (684783, 7559), (692342, 7055), (699397, 7795), (707192, 8857), (716049, 7792), (723841, 7438), (731279, 7714), (738993, 7745), (746738, 7672), (754410, 7781), (762191, 7101), (769292, 7923), (777215, 7226), (784441, 7797), (792238, 7368), (799606, 7697), (807303, 7412), (814715, 7619), (822334, 8288), (830622, 7915), (838537, 7826), (846363, 7505), (853868, 7553), (861421, 8428), (869849, 7839), (877688, 7238), (884926, 7448), (892374, 7689), (900063, 7721), (907784, 7783), (915567, 8133), (923700, 7602), (931302, 7762), (939064, 7812), (946876, 7766), (954642, 7310), (961952, 7818), (969770, 8290), (978060, 7468), (985528, 7572), (993100, 8594), (1001694, 7460), (1009154, 8838), (1017992, 8416), (1026408, 7444), (1033852, 7378), (1041230, 7173), (1048403, 7617), (1056020, 8271), (1064291, 8308), (1072599, 9015), (1081614, 8060), (1089674, 8158), (1097832, 8634), (1106466, 8135), (1114601, 7500), (1122101, 7668), (1129769, 8612), (1138381, 7016), (1145397, 8034), (1153431, 7562), (1160993, 7658), (1168651, 7907), (1176558, 7894), (1184452, 7845), (1192297, 7768), (1200065, 7328), (1207393, 7390), (1214783, 8027), (1222810, 7907), (1230717, 7931), (1238648, 7479), (1246127, 7000), (1253127, 7328), (1260455, 7698), (1268153, 7792), (1275945, 7472), (1283417, 8263), (1291680, 8404), (1300084, 8095), (1308179, 7512), (1315691, 8924), (1324615, 7778), (1332393, 7670), (1340063, 7752), (1347815, 8160), (1355975, 7199), (1363174, 7377), (1370551, 7937), (1378488, 8146), (1386634, 8188), (1394822, 7393), (1402215, 7261), (1409476, 9559), (1419035, 8320), (1427355, 7391), (1434746, 7748), (1442494, 7890), (1450384, 8028), (1458412, 7057), (1465469, 8307), (1473776, 7905), (1481681, 7859), (1489540, 7924), (1497464, 7294), (1504758, 7600), (1512358, 7055), (1519413, 7857), (1527270, 7050), (1534320, 7088), (1541408, 7206), (1548614, 7650), (1556264, 7864), (1564128, 7624), (1571752, 7863), (1579615, 8215), (1587830, 7102), (1594932, 8374), (1603306, 8125), (1611431, 7395), (1618826, 7923), (1626749, 8794), (1635543, 7391), (1642934, 8446), (1651380, 7930), (1659310, 7473), (1666783, 8044), (1674827, 7981), (1682808, 7995), (1690803, 7594), (1698397, 7990), (1706387, 7546), (1713933, 8443), (1722376, 7631), (1730007, 7373), (1737380, 8269), (1745649, 7764), (1753413, 8038), (1761451, 7366), (1768817, 8135), (1776952, 8049), (1785001, 8085), (1793086, 8547), (1801633, 8336), (1809969, 7887), (1817856, 7866), (1825722, 8104), (1833826, 7543), (1841369, 8662), (1850031, 7828), (1857859, 7054), (1864913, 7188), (1872101, 8187), (1880288, 8384), (1888672, 8217), (1896889, 8190), (1905079, 7730), (1912809, 7464), (1920273, 8405), (1928678, 7979), (1936657, 7760), (1944417, 8041), (1952458, 6948), (1959406, 7876), (1967282, 7904), (1975186, 7869), (1983055, 7272), (1990327, 7719), (1998046, 7892)], [(2005938, 807), (2006745, 746), (2007491, 771), (2008262, 727), (2008989, 791), (2009780, 721), (2010501, 623), (2011124, 790), (2011914, 550), (2012464, 839), (2013303, 470), (2013773, 591), (2014364, 734), (2015098, 874), (2015972, 756), (2016728, 584), (2017312, 1198), (2018510, 610), (2019120, 682), (2019802, 768), (2020570, 1051), (2021621, 685), (2022306, 660), (2022966, 544), (2023510, 647), (2024157, 614), (2024771, 784), (2025555, 1274), (2026829, 684), (2027513, 729), (2028242, 789), (2029031, 644), (2029675, 583), (2030258, 646), (2030904, 890), (2031794, 882), (2032676, 469), (2033145, 783), (2033928, 621), (2034549, 803), (2035352, 690), (2036042, 696), (2036738, 621), (2037359, 785), (2038144, 665), (2038809, 680), (2039489, 560), (2040049, 667), (2040716, 673), (2041389, 425), (2041814, 650), (2042464, 700), (2043164, 659), (2043823, 838), (2044661, 1066), (2045727, 610), (2046337, 713), (2047050, 662), (2047712, 553), (2048265, 600), (2048865, 706), (2049571, 878), (2050449, 893), (2051342, 778), (2052120, 604), (2052724, 660), (2053384, 922), (2054306, 524), (2054830, 489), (2055319, 937), (2056256, 666), (2056922, 716), (2057638, 370), (2058008, 672), (2058680, 404), (2059084, 650), (2059734, 558), (2060292, 849), (2061141, 718), (2061859, 522), (2062381, 745), (2063126, 697), (2063823, 794), (2064617, 664), (2065281, 769), (2066050, 747), (2066797, 660), (2067457, 541), (2067998, 829), (2068827, 814), (2069641, 1074), (2070715, 1000), (2071715, 880), (2072595, 681), (2073276, 618), (2073894, 454), (2074348, 858), (2075206, 600), (2075806, 700), (2076506, 569), (2077075, 739), (2077814, 718), (2078532, 738), (2079270, 498), (2079768, 780), (2080548, 870), (2081418, 585), (2082003, 493), (2082496, 760), (2083256, 860), (2084116, 759), (2084875, 897), (2085772, 967), (2086739, 637), (2087376, 640), (2088016, 671), (2088687, 689), (2089376, 769), (2090145, 612), (2090757, 640), (2091397, 972), (2092369, 667), (2093036, 820), (2093856, 698), (2094554, 637), (2095191, 597), (2095788, 757), (2096545, 732), (2097277, 575), (2097852, 873), (2098725, 639), (2099364, 755), (2100119, 597), (2100716, 639), (2101355, 562), (2101917, 757), (2102674, 645), (2103319, 661), (2103980, 575), (2104555, 668), (2105223, 760), (2105983, 619), (2106602, 602), (2107204, 490), (2107694, 649), (2108343, 448), (2108791, 827), (2109618, 626), (2110244, 820), (2111064, 639), (2111703, 759), (2112462, 502), (2112964, 719), (2113683, 860), (2114543, 936), (2115479, 729), (2116208, 786), (2116994, 860), (2117854, 797), (2118651, 618), (2119269, 911), (2120180, 613), (2120793, 704), (2121497, 759), (2122256, 1017), (2123273, 943), (2124216, 483), (2124699, 875), (2125574, 659), (2126233, 534), (2126767, 688), (2127455, 462), (2127917, 925), (2128842, 588), (2129430, 937), (2130367, 772), (2131139, 839), (2131978, 617), (2132595, 617), (2133212, 706), (2133918, 1830), (2135748, 620), (2136368, 608), (2136976, 798), (2137774, 919), (2138693, 570), (2139263, 693), (2139956, 733), (2140689, 556), (2141245, 869), (2142114, 632), (2142746, 578), (2143324, 536), (2143860, 1033), (2144893, 715), (2145608, 641), (2146249, 547), (2146796, 636), (2147432, 728), (2148160, 586), (2148746, 793), (2149539, 698), (2150237, 805), (2151042, 646), (2151688, 658), (2152346, 517), (2152863, 687), (2153550, 914), (2154464, 746), (2155210, 686), (2155896, 723), (2156619, 635), (2157254, 737), (2157991, 1075), (2159066, 500), (2159566, 674), (2160240, 681), (2160921, 751), (2161672, 630), (2162302, 550), (2162852, 668), (2163520, 758), (2164278, 681), (2164959, 977), (2165936, 533), (2166469, 613), (2167082, 637), (2167719, 710), (2168429, 692), (2169121, 742), (2169863, 765), (2170628, 423), (2171051, 873), (2171924, 552), (2172476, 644), (2173120, 654), (2173774, 778), (2174552, 505), (2175057, 830), (2175887, 775), (2176662, 699), (2177361, 455), (2177816, 771), (2178587, 439), (2179026, 750), (2179776, 538), (2180314, 608), (2180922, 786), (2181708, 595), (2182303, 871), (2183174, 2256), (2185430, 562), (2185992, 740), (2186732, 713), (2187445, 772), (2188217, 635)], [(2188852, 48), None, None, (2188900, 42), None, (2188942, 27), None, None, None, None, None, None, None, None, (2188969, 21), None, None, (2188990, 42), None, (2189032, 25), (2189057, 44), None, (2189101, 49), None, None, None, None, None, None, None, None, None, (2189150, 21), (2189171, 46), None, None, (2189217, 44), None, None, None, None, (2189261, 44), (2189305, 21), (2189326, 23), None, None, None, None, (2189349, 26), None, None, None, None, None, (2189375, 31), None, None, None, None, (2189406, 42), None, None, None, (2189448, 21), None, (2189469, 26), (2189495, 56), None, None, (2189551, 42), (2189593, 27), None, None, None, None, (2189620, 21), (2189641, 52), None, None, (2189693, 20), (2189713, 42), None, None, None, (2189755, 25), (2189780, 17), (2189797, 27), (2189824, 21), None, None, None, (2189845, 24), None, (2189869, 24), (2189893, 21), (2189914, 24), None, (2189938, 48), None, None, None, (2189986, 19), None, None, None, None, None, None, None, None, None, None, None, (2190005, 28), None, (2190033, 64), (2190097, 42), (2190139, 17), (2190156, 17), (2190173, 26), None, (2190199, 19), None, None, None, None, (2190218, 20), None, None, (2190238, 42), (2190280, 63), None, (2190343, 20), None, (2190363, 21), None, None, None, None, (2190384, 21), (2190405, 16), None, (2190421, 31), None, None, None, None, (2190452, 42), None, (2190494, 80), None, (2190574, 9), None, (2190583, 21), (2190604, 42), None, (2190646, 18), (2190664, 65), (2190729, 56), (2190785, 45), None, (2190830, 42), None, None, (2190872, 24), (2190896, 21), None, None, None, None, None, (2190917, 42), (2190959, 21), (2190980, 21), None, (2191001, 42), (2191043, 25), None, (2191068, 40), (2191108, 21), (2191129, 56), None, None, (2191185, 21), None, None, None, (2191206, 16), None, (2191222, 35), None, None, (2191257, 21), None, (2191278, 22), (2191300, 21), (2191321, 21), (2191342, 21), None, (2191363, 63), (2191426, 41), (2191467, 21), (2191488, 42), None, None, None, None, None, (2191530, 15), (2191545, 21), (2191566, 21), None, None, (2191587, 21), None, None, (2191608, 21), None, None, None, (2191629, 66), None, None, None, (2191695, 50), None, (2191745, 21), (2191766, 21), (2191787, 19), None, None, (2191806, 26), None, (2191832, 39), (2191871, 42), None, None, None, None, None, None, (2191913, 21), None, None, None, (2191934, 21), None, None, (2191955, 64), None, (2192019, 254), (2192273, 21), (2192294, 24), None, (2192318, 21), None], [None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, (2192339, 62), None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None]]  # noqa: E501
_CRC8_TABLE = [
    0x00, 0x07, 0x0e, 0x09, 0x1c, 0x1b, 0x12, 0x15,
    0x38, 0x3f, 0x36, 0x31, 0x24, 0x23, 0x2a, 0x2d,
    0x70, 0x77, 0x7e, 0x79, 0x6c, 0x6b, 0x62, 0x65,
    0x48, 0x4f, 0x46, 0x41, 0x54, 0x53, 0x5a, 0x5d,
    0xe0, 0xe7, 0xee, 0xe9, 0xfc, 0xfb, 0xf2, 0xf5,
    0xd8, 0xdf, 0xd6, 0xd1, 0xc4, 0xc3, 0xca, 0xcd,
    0x90, 0x97, 0x9e, 0x99, 0x8c, 0x8b, 0x82, 0x85,
    0xa8, 0xaf, 0xa6, 0xa1, 0xb4, 0xb3, 0xba, 0xbd,
    0xc7, 0xc0, 0xc9, 0xce, 0xdb, 0xdc, 0xd5, 0xd2,
    0xff, 0xf8, 0xf1, 0xf6, 0xe3, 0xe4, 0xed, 0xea,
    0xb7, 0xb0, 0xb9, 0xbe, 0xab, 0xac, 0xa5, 0xa2,
    0x8f, 0x88, 0x81, 0x86, 0x93, 0x94, 0x9d, 0x9a,
    0x27, 0x20, 0x29, 0x2e, 0x3b, 0x3c, 0x35, 0x32,
    0x1f, 0x18, 0x11, 0x16, 0x03, 0x04, 0x0d, 0x0a,
    0x57, 0x50, 0x59, 0x5e, 0x4b, 0x4c, 0x45, 0x42,
    0x6f, 0x68, 0x61, 0x66, 0x73, 0x74, 0x7d, 0x7a,
    0x89, 0x8e, 0x87, 0x80, 0x95, 0x92, 0x9b, 0x9c,
    0xb1, 0xb6, 0xbf, 0xb8, 0xad, 0xaa, 0xa3, 0xa4,
    0xf9, 0xfe, 0xf7, 0xf0, 0xe5, 0xe2, 0xeb, 0xec,
    0xc1, 0xc6, 0xcf, 0xc8, 0xdd, 0xda, 0xd3, 0xd4,
    0x69, 0x6e, 0x67, 0x60, 0x75, 0x72, 0x7b, 0x7c,
    0x51, 0x56, 0x5f, 0x58, 0x4d, 0x4a, 0x43, 0x44,
    0x19, 0x1e, 0x17, 0x10, 0x05, 0x02, 0x0b, 0x0c,
    0x21, 0x26, 0x2f, 0x28, 0x3d, 0x3a, 0x33, 0x34,
    0x4e, 0x49, 0x40, 0x47, 0x52, 0x55, 0x5c, 0x5b,
    0x76, 0x71, 0x78, 0x7f, 0x6a, 0x6d, 0x64, 0x63,
    0x3e, 0x39, 0x30, 0x37, 0x22, 0x25, 0x2c, 0x2b,
    0x06, 0x01, 0x08, 0x0f, 0x1a, 0x1d, 0x14, 0x13,
    0xae, 0xa9, 0xa0, 0xa7, 0xb2, 0xb5, 0xbc, 0xbb,
    0x96, 0x91, 0x98, 0x9f, 0x8a, 0x8d, 0x84, 0x83,
    0xde, 0xd9, 0xd0, 0xd7, 0xc2, 0xc5, 0xcc, 0xcb,
    0xe6, 0xe1, 0xe8, 0xef, 0xfa, 0xfd, 0xf4, 0xf3
]
# fmt: on

_IS_LEAF = 0x80
_INCLUDE_SUBDOMAINS = 0x40


try:
    from importlib.resources import open_binary

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open_binary("hstspreload", path)


except ImportError:

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open(
            os.path.join(os.path.dirname(os.path.abspath(__file__)), path),
            "rb",
        )


@functools.lru_cache(maxsize=1024)
def in_hsts_preload(host: typing.AnyStr) -> bool:
    """Determines if an IDNA-encoded host is on the HSTS preload list"""

    if isinstance(host, str):
        host = host.encode("ascii")
    labels = host.lower().split(b".")

    # Fast-branch for gTLDs that are registered to preload all sub-domains.
    if labels[-1] in _GTLD_INCLUDE_SUBDOMAINS:
        return True

    with open_pkg_binary("hstspreload.bin") as f:
        for layer, label in enumerate(labels[::-1]):
            # None of our layers are greater than 5 deep.
            if layer > 4:
                return False

            # Read the jump table for the layer and label
            jump_info = _JUMPTABLE[layer][_crc8(label)]
            if jump_info is None:
                # No entry: host is not preloaded
                return False

            # Read the set of entries for that layer and label
            f.seek(jump_info[0])
            data = bytearray(jump_info[1])
            f.readinto(data)

            for is_leaf, include_subdomains, ent_label in _iter_entries(data):
                # We found a potential leaf
                if is_leaf:
                    if ent_label == host:
                        return True
                    if include_subdomains and host.endswith(b"." + ent_label):
                        return True

                # Continue traversing as we're not at a leaf.
                elif label == ent_label:
                    break
            else:
                return False
    return False


def _iter_entries(data: bytes) -> typing.Iterable[typing.Tuple[int, int, bytes]]:
    while data:
        flags = data[0]
        size = data[1]
        label = bytes(data[2 : 2 + size])
        yield (flags & _IS_LEAF, flags & _INCLUDE_SUBDOMAINS, label)
        data = data[2 + size :]


def _crc8(value: bytes) -> int:
    # CRC8 reference implementation: https://github.com/niccokunzmann/crc8
    checksum = 0x00
    for byte in value:
        checksum = _CRC8_TABLE[checksum ^ byte]
    return checksum
